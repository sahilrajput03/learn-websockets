<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="https://cdn.socket.io/4.5.0/socket.io.min.js" integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k" crossorigin="anonymous"></script>
		<title>Document</title>
		<script>
			window.onload = () => {
				// io object is available globally bcoz we linked `socket.io` script from cdn.
				const socket = io('ws://localhost:8081')
				window.socket = socket // for making it accessible by browser console for debugging
				window.name

				// (BELOW WORKS VERY GOOD THOUGH but removed in favor of getting realistic name from 'name' event from server)
				// Adding `name` to dom
				// socket.on('connect', () => {
				// Faking it from `socket.id`
				// 	document.querySelector('#name').innerHTML = socket.id.substr(0, 2)
				// })

				// Getting name from 'name' event and setting it in dom
				socket.on('name', (name) => {
					document.querySelector('#name').innerHTML = name
					window.name = name
				})

				// Receiving message LOGIC
				socket.on('message', (payload) => {
					let {clientId, name, message} = payload

					// Using 'You' identifier if the message belong to current user:
					if (clientId === socket.id) {
						name = 'You'
					}

					const el = document.createElement('div')
					el.innerHTML = name + ': ' + message
					document.querySelector('#messages-container').appendChild(el)
				})

				// Sending message LOGIC
				const sendMessg = () => {
					const data = document.querySelector('input').value
					socket.emit('message', data)
					document.querySelector('input').value = ''
				}

				// ATTACH to Send button click (not using send buttton anymore infavor of direct `Enter` key)
				// document.querySelector('#btn-send').onclick = sendMessg

				// ATTACH to `Enter` button event
				document.querySelector('input').onkeydown = (e) => {
					if (e.key === 'Enter') {
						sendMessg()
					}
				}
			}
		</script>
	</head>
	<body style="text-align: center">
		Group Chat App
		<div>
			User:
			<span id="name"></span>
		</div>

		<br />
		<section>
			CHAT BOX
			<div id="messages-container"></div>
		</section>

		<input placeholder="message" />
		<!-- <button id="btn-send">Send</button> -->

		<div>(Press Enter key to send)</div>
	</body>
</html>
